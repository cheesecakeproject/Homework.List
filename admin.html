<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Homework Record</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="font-sans bg-white dark:bg-gray-900 text-gray-900 dark:text-white transition-colors duration-200 min-h-screen flex flex-col">
    <!-- Dark mode detection -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <!-- Authentication check -->
    <script>
        // Check if user is authenticated
        document.addEventListener('DOMContentLoaded', function() {
            const isAuthenticated = sessionStorage.getItem('adminAuthenticated') === 'true';
            
            if (!isAuthenticated) {
                // Redirect to login page if not authenticated
                window.location.href = '/login.html';
            }
        });
    </script>

    <!-- Header -->
    <header class="py-6 px-4 sm:px-6 md:px-8 border-b border-gray-200 dark:border-gray-800 flex justify-between items-center">
        <h1 class="text-2xl font-semibold">Admin Dashboard</h1>
        <button id="logout-button" class="px-4 py-2 text-sm bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-gray-700 rounded-lg transition-colors">
            Logout
        </button>
    </header>

    <!-- Main content -->
    <main class="flex-grow p-4 sm:p-6 md:p-8">
        <div class="max-w-3xl mx-auto">
            <section class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-8">
                <h2 class="text-xl font-semibold mb-4">Add Homework Record</h2>
                
                <form id="homework-form" class="space-y-6">
                    <div>
                        <label for="date-picker" class="block text-sm font-medium mb-2">Date</label>
                        <input type="date" id="date-picker" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-base focus:outline-none focus:ring-2 focus:ring-primary" required>
                    </div>
                    
                    <div>
                        <label for="homework-data" class="block text-sm font-medium mb-2">Homework Details</label>
                        <textarea id="homework-data" rows="6" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-base focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Enter homework details..." required></textarea>
                    </div>
                    
                    <button type="submit" class="w-full bg-primary hover:bg-opacity-90 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
                        <span id="submit-text">Add Homework</span>
                        <svg id="submit-spinner" class="animate-spin ml-2 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                </form>
            </section>
            
            <div id="status-message" class="hidden p-4 rounded-lg mb-8"></div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set date input to today's date by default
            const datePicker = document.getElementById('date-picker');
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0]; // Format: YYYY-MM-DD
            datePicker.value = formattedDate;
            
            // Logout button functionality
            const logoutButton = document.getElementById('logout-button');
            logoutButton.addEventListener('click', function() {
                // Clear authentication
                sessionStorage.removeItem('adminAuthenticated');
                // Redirect to homepage
                window.location.href = '/';
            });
            
            // Form submission
            const homeworkForm = document.getElementById('homework-form');
            const homeworkData = document.getElementById('homework-data');
            const submitText = document.getElementById('submit-text');
            const submitSpinner = document.getElementById('submit-spinner');
            const statusMessage = document.getElementById('status-message');
            
            homeworkForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Clear previous status message
                hideStatus();
                
                // Show loading state
                setSubmitting(true);
                
                const selectedDate = new Date(datePicker.value);
                const data = homeworkData.value.trim();
                
                if (!data) {
                    showStatus('Please enter homework details', 'error');
                    setSubmitting(false);
                    return;
                }
                
                try {
                    // Format the date for the path: /yyyy/dd/mm
                    const year = selectedDate.getFullYear();
                    const day = String(selectedDate.getDate()).padStart(2, '0');
                    const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
                    const path = `/${year}/${day}/${month}`;
                    
                    // In a real application, this would be a server-side storage operation
                    // For this example, we'll simulate a successful save
                    
                    // Simulating server-side storage with a delay
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Log the data path (in a real app, this would be saved to a database or file system)
                    console.log(`Saving homework data to path: ${path}`);
                    console.log(`Data: ${data}`);
                    
                    // Show success message
                    showStatus(`Homework successfully added for ${day}/${month}/${year}`, 'success');
                    
                    // Clear the form data
                    homeworkData.value = '';
                    
                    setSubmitting(false);
                } catch (error) {
                    showStatus('An error occurred while saving the homework data', 'error');
                    setSubmitting(false);
                    console.error(error);
                }
            });
            
            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.classList.remove('hidden', 'bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700');
                
                if (type === 'success') {
                    statusMessage.classList.add('bg-green-100', 'text-green-700', 'dark:bg-green-900/30', 'dark:text-green-400');
                } else if (type === 'error') {
                    statusMessage.classList.add('bg-red-100', 'text-red-700', 'dark:bg-red-900/30', 'dark:text-red-400');
                }
            }
            
            function hideStatus() {
                statusMessage.textContent = '';
                statusMessage.classList.add('hidden');
            }
            
            function setSubmitting(isSubmitting) {
                if (isSubmitting) {
                    submitText.textContent = 'Adding...';
                    submitSpinner.classList.remove('hidden');
                    homeworkData.disabled = true;
                    datePicker.disabled = true;
                } else {
                    submitText.textContent = 'Add Homework';
                    submitSpinner.classList.add('hidden');
                    homeworkData.disabled = false;
                    datePicker.disabled = false;
                }
            }
        });
    </script>
</body>
</html>
