<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homework Details | Homework Record</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="font-sans bg-white dark:bg-gray-900 text-gray-900 dark:text-white transition-colors duration-200 min-h-screen flex flex-col">
    <!-- Dark mode detection -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <!-- Header -->
    <header class="py-6 px-4 sm:px-6 md:px-8 border-b border-gray-200 dark:border-gray-800 flex items-center">
        <a href="/" class="mr-4 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
        </a>
        <h1 class="text-2xl font-semibold">Homework Details</h1>
    </header>

    <!-- Main content -->
    <main class="flex-grow p-4 sm:p-6 md:p-8">
        <div class="max-w-3xl mx-auto">
            <!-- Date display -->
            <div class="mb-6">
                <h2 id="date-display" class="text-xl font-medium"></h2>
            </div>

            <!-- Loading state -->
            <div id="loading-state" class="text-center py-12">
                <div class="animate-spin mx-auto h-10 w-10 border-4 border-primary border-opacity-50 rounded-full border-t-transparent"></div>
                <p class="mt-4 text-lg text-gray-600 dark:text-gray-400">Loading homework data...</p>
            </div>

            <!-- No data state -->
            <div id="no-data-state" class="hidden bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-400 dark:text-gray-600 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <h3 class="text-lg font-medium mb-2">No Homework Found</h3>
                <p class="text-gray-600 dark:text-gray-400 mb-6">There is no homework recorded for this date.</p>
                <a href="/" class="inline-block bg-primary hover:bg-opacity-90 text-white font-medium py-2 px-6 rounded-lg transition-colors">
                    Back to Calendar
                </a>
            </div>

            <!-- Data display -->
            <div id="data-container" class="hidden space-y-4"></div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="p-4 sm:p-6 md:p-8 border-t border-gray-200 dark:border-gray-800">
        <div class="w-full max-w-md mx-auto space-y-4">
            <a href="/" class="block w-full bg-primary hover:bg-opacity-90 text-white font-medium py-3 px-4 rounded-lg transition-colors text-center">
                Back to Calendar
            </a>
            <a href="https://thisisdice.vercel.app" target="_blank" class="block w-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-800 dark:text-white font-medium py-3 px-4 rounded-lg transition-colors text-center">
                Random Number Generator
            </a>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get date from URL
            const urlParams = new URLSearchParams(window.location.search);
            const dateParam = urlParams.get('date');
            
            if (!dateParam || !/^\d{8}$/.test(dateParam)) {
                // Invalid date parameter - redirect to 404
                window.location.href = '/404.html';
                return;
            }
            
            // Extract components from date (format: ddmmyyyy)
            const day = dateParam.substring(0, 2);
            const month = dateParam.substring(2, 4);
            const year = dateParam.substring(4, 8);
            
            // Format date for display
            const dateObj = new Date(`${year}-${month}-${day}`);
            const dateDisplay = document.getElementById('date-display');
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            dateDisplay.textContent = dateObj.toLocaleDateString('en-US', options);
            
            // Elements
            const loadingState = document.getElementById('loading-state');
            const noDataState = document.getElementById('no-data-state');
            const dataContainer = document.getElementById('data-container');
            
            // Fetch homework data for this date
            fetchHomeworkData(year, month, day);
            
            async function fetchHomeworkData(year, month, day) {
                try {
                    // In a real application, this would be an API call to fetch data
                    // For example: const response = await fetch(`/api/homework/${year}/${month}/${day}`);
                    
                    // Simulate fetch delay for demonstration
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    // For demo purposes, randomly decide if we have data or not
                    const hasData = Math.random() > 0.3; // 70% chance of having data
                    
                    if (hasData) {
                        // Simulate 1-3 homework entries
                        const entryCount = Math.floor(Math.random() * 3) + 1;
                        const entries = [];
                        
                        for (let i = 0; i < entryCount; i++) {
                            const randomId = Math.random().toString(36).substring(2, 8);
                            entries.push({
                                id: randomId,
                                info: getSampleHomework(),
                                path: `/${year}/${month}/${day}/id/${randomId}/info`
                            });
                        }
                        
                        // Display the entries
                        displayHomeworkEntries(entries);
                    } else {
                        // Show no data state
                        loadingState.classList.add('hidden');
                        noDataState.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error('Error fetching homework data:', error);
                    
                    // Show error state (using the no data state as fallback)
                    loadingState.classList.add('hidden');
                    noDataState.querySelector('h3').textContent = 'Error Loading Data';
                    noDataState.querySelector('p').textContent = 'There was a problem loading the homework data. Please try again later.';
                    noDataState.classList.remove('hidden');
                }
            }
            
            function displayHomeworkEntries(entries) {
                // Hide loading, show data container
                loadingState.classList.add('hidden');
                dataContainer.classList.remove('hidden');
                
                // Clear previous entries
                dataContainer.innerHTML = '';
                
                // Add each entry
                entries.forEach(entry => {
                    const entryElement = document.createElement('div');
                    entryElement.className = 'bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6';
                    
                    const content = document.createElement('div');
                    content.className = 'prose dark:prose-invert max-w-none';
                    content.innerHTML = `<p>${entry.info}</p>`;
                    
                    const footer = document.createElement('div');
                    footer.className = 'mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 text-sm text-gray-500 dark:text-gray-400';
                    footer.textContent = `ID: ${entry.id}`;
                    
                    entryElement.appendChild(content);
                    entryElement.appendChild(footer);
                    
                    dataContainer.appendChild(entryElement);
                });
            }
            
            // Helper function to get sample homework content
            function getSampleHomework() {
                const homeworkOptions = [
                    "Complete exercises 1-10 on page 45 of the textbook. Submit answers in class tomorrow.",
                    "Read chapter 7 and prepare a one-page summary of the key concepts. Due on Friday.",
                    "Finish the research project on renewable energy sources. Presentation scheduled for next Monday.",
                    "Solve the practice problems from the handout. Show all your work and calculations.",
                    "Complete the online quiz by midnight tonight. Access code is provided in your email.",
                    "Write a 500-word essay on the assigned topic. Submit through the online portal.",
                    "Review the lecture notes and prepare questions for the discussion section tomorrow.",
                    "Complete the lab report using the template provided in class. Due next Wednesday."
                ];
                
                return homeworkOptions[Math.floor(Math.random() * homeworkOptions.length)];
            }
        });
    </script>
</body>
</html>